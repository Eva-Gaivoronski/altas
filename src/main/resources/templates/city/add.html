<!DOCTYPE html>
<html lang="en" xmlns:th="https://www.thymeleaf.org/">
<head th:replace="~{fragments :: head}"></head>
<body>
<header th:replace="~{fragments :: page-header}"></header>
<div id="admin-bar">
    <div class="nav">
        <a class="navlink" href="/city">All Cities</a>
        <span class="faux-link">Search</span>
        <a class="navlink" href="/city/delete">Delete A City</a>
    </div>
</div>
<main>
    <form method="POST" style="max-width:600px;">
        <h3>Add a City</h3>
        <div class="container">
            <div class="form-item">
                <label th:for="cityName">City</label>
                <input class="form-control" th:field="${city.name}" />
                <span th:errors="${city.name}" class="error"></span>
            </div>
            <div class="form-item">
                <label th:for="state">State</label>
                <select id="city.state" name="city.state" th:field="*{city.state}" required>
                    <option value="">Select State</option>
                    <!-- Options will be populated by JavaScript -->
                    <script>
                        document.addEventListener('DOMContentLoaded', function() {
                            fetch('/states/states.json')
                                .then(response => response.json())
                                .then(states => {
                                    const selectElement = document.getElementById('city.state');
                                    states.forEach(state => {
                                        const option = document.createElement('option');
                                        option.value = state.abbreviation;
                                        option.textContent = state.name;
                                        selectElement.appendChild(option);
                                    });
                                })
                                .catch(error => console.error('Error loading state data:', error));
                        });
                    </script>
                </select>
            </div>
        </div>
        <div class="error" th:if="${#fields.hasErrors('city.state')}" th:errors="*{city.state}"></div>
        <button type="submit">Add City</button>
    </form>
</main>
</body>
</html>